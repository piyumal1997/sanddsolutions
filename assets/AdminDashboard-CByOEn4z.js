import{r as o,j as e}from"./index-BmmDSopB.js";import{S as i}from"./sweetalert2.esm.all-CHfsb5jC.js";const g="",Y=()=>{const[c,y]=o.useState(localStorage.getItem("adminToken")||""),[P,j]=o.useState(""),[D,k]=o.useState(!0),[u,$]=o.useState(""),[w,T]=o.useState(""),[l,v]=o.useState(!1),[x,N]=o.useState([]),[n,S]=o.useState(null),[r,d]=o.useState({title:"",description:"",type:"residential-solar",date:"",details:""}),[p,h]=o.useState([]),[f,C]=o.useState(!1);o.useEffect(()=>{c?b():k(!1)},[c]);const b=async()=>{try{const t=await fetch(`${g}/api/projects`,{headers:{Authorization:`Bearer ${c}`}});if(!t.ok){const a=await t.json();throw new Error(a.message||"Failed to fetch projects")}const s=await t.json();N(s)}catch(t){i.fire({icon:"error",title:"Error",text:t.message||"Could not load projects"})}},L=async t=>{t.preventDefault();const s=l?"register":"login";try{const a=await fetch(`${g}/api/auth/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,password:w})}),m=await a.json();if(!a.ok)throw new Error(m.message||(l?"Registration failed":"Login failed"));l?(i.fire({icon:"success",title:"Registered!",text:"You can now log in."}),v(!1)):(localStorage.setItem("adminToken",m.token),y(m.token),j(m.user?.email||u),i.fire({icon:"success",title:"Logged in",text:"Welcome to the Admin Dashboard",timer:1800}))}catch(a){i.fire({icon:"error",title:"Authentication Error",text:a.message})}},B=async()=>{(await i.fire({title:"Log out?",text:"You will be logged out of the admin dashboard.",icon:"question",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, log out"})).isConfirmed&&(localStorage.removeItem("adminToken"),y(""),j(""),N([]),i.fire({icon:"success",title:"Logged Out",timer:1500}))},I=async t=>{t.preventDefault(),C(!0);const s=new FormData;s.append("title",r.title),s.append("description",r.description),s.append("type",r.type),s.append("date",r.date),s.append("details",r.details),n&&s.append("existingImages",JSON.stringify(n.images||[])),p.forEach(a=>{s.append("images",a)});try{const a=n?`${g}/api/projects/${n.id}`:`${g}/api/projects`,A=await fetch(a,{method:n?"PUT":"POST",headers:{Authorization:`Bearer ${c}`},body:s});if(!A.ok){const U=await A.json();throw new Error(U.message||"Operation failed")}i.fire({icon:"success",title:n?"Project Updated":"Project Added",timer:1800}),b(),E()}catch(a){i.fire({icon:"error",title:"Error",text:a.message||"Failed to save project"})}finally{C(!1)}},R=t=>{S(t),d({title:t.title||"",description:t.description||"",type:t.type||"residential-solar",date:t.date||"",details:t.details||""}),h([])},F=async t=>{if((await i.fire({title:"Delete project?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete"})).isConfirmed)try{if(!(await fetch(`${g}/api/projects/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${c}`}})).ok)throw new Error("Delete failed");i.fire("Deleted!","Project removed.","success"),b()}catch(a){i.fire("Error",a.message||"Could not delete project","error")}},E=()=>{S(null),d({title:"",description:"",type:"residential-solar",date:"",details:""}),h([])};return D?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Loading..."})]})}):c?e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-12 gap-6",children:[e.jsx("h1",{className:"text-4xl sm:text-5xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("p",{className:"text-lg text-gray-700",children:["Logged in: ",P||"Admin"]}),e.jsx("button",{onClick:B,className:"bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition font-medium",children:"Logout"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-16",children:[e.jsx("h2",{className:"text-3xl font-bold mb-8",children:n?"Edit Project":"Add New Project"}),e.jsxs("form",{onSubmit:I,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",placeholder:"Title *",value:r.title,onChange:t=>d({...r,title:t.target.value}),required:!0,className:"px-6 py-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"}),e.jsxs("select",{value:r.type,onChange:t=>d({...r,type:t.target.value}),className:"px-6 py-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",children:[e.jsx("option",{value:"residential-solar",children:"Residential Solar"}),e.jsx("option",{value:"industrial-solar",children:"Industrial Solar"}),e.jsx("option",{value:"automation",children:"Automation"}),e.jsx("option",{value:"engineering",children:"Engineering"})]}),e.jsx("input",{type:"date",value:r.date,onChange:t=>d({...r,date:t.target.value}),className:"px-6 py-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"}),e.jsx("textarea",{placeholder:"Description *",value:r.description,onChange:t=>d({...r,description:t.target.value}),required:!0,rows:4,className:"md:col-span-2 px-6 py-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"}),e.jsx("textarea",{placeholder:"Details (optional)",value:r.details,onChange:t=>d({...r,details:t.target.value}),rows:6,className:"md:col-span-2 px-6 py-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-lg font-medium mb-3 text-gray-700",children:"Upload Images / Videos"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:t=>h(Array.from(t.target.files||[])),className:"w-full px-4 py-3 border border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100"}),p.length>0&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[p.length," file(s) selected"]})]}),n&&n.images?.length>0&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("p",{className:"text-lg font-medium mb-4 text-gray-700",children:["Current Images (",n.images.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:n.images.map((t,s)=>e.jsx("div",{className:"relative group",children:e.jsx("img",{src:t.startsWith("/")?`${g}${t}`:t,alt:`Project image ${s+1}`,className:"w-full h-32 object-cover rounded-lg shadow-sm"})},s))})]}),e.jsxs("div",{className:"md:col-span-2 flex flex-col sm:flex-row gap-4 mt-6",children:[e.jsx("button",{type:"submit",disabled:f,className:`flex-1 py-4 px-8 rounded-lg font-semibold text-white transition ${f?"bg-green-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:f?"Saving...":n?"Update Project":"Add Project"}),n&&e.jsx("button",{type:"button",onClick:E,className:"flex-1 bg-gray-600 text-white py-4 px-8 rounded-lg hover:bg-gray-700 transition font-semibold",children:"Cancel"})]})]})]}),e.jsxs("h2",{className:"text-3xl font-bold mb-8 text-gray-900",children:["Existing Projects (",x.length,")"]}),x.length===0?e.jsx("p",{className:"text-gray-500 text-center py-12",children:"No projects yet."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",children:x.map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3 text-gray-900",children:t.title}),e.jsx("p",{className:"text-gray-600 mb-4 line-clamp-3",children:t.description}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1 mb-6",children:[e.jsxs("p",{children:["Type: ",t.type.replace("-"," ").toUpperCase()]}),e.jsxs("p",{children:["Date: ",t.date||"N/A"]}),e.jsxs("p",{children:["Images: ",t.images?.length||0]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>R(t),className:"flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition",children:"Edit"}),e.jsx("button",{onClick:()=>F(t.id),className:"flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition",children:"Delete"})]})]},t.id))})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("form",{onSubmit:L,className:"bg-white p-10 rounded-xl shadow-2xl w-full max-w-md",children:[e.jsx("h2",{className:"text-4xl font-bold text-center mb-8",children:l?"Register Admin":"Admin Login"}),e.jsx("input",{type:"email",placeholder:"Email",value:u,onChange:t=>$(t.target.value),required:!0,className:"w-full px-6 py-4 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-green-500"}),e.jsx("input",{type:"password",placeholder:"Password",value:w,onChange:t=>T(t.target.value),required:!0,className:"w-full px-6 py-4 border rounded-lg mb-6 focus:outline-none focus:ring-2 focus:ring-green-500"}),e.jsx("button",{type:"submit",className:"w-full bg-green-600 text-white py-4 rounded-lg hover:bg-green-700 transition font-semibold",children:l?"Register":"Login"}),e.jsxs("p",{className:"text-center mt-6 text-gray-600",children:[l?"Already have an account?":"Don't have an account?"," ",e.jsx("button",{type:"button",onClick:()=>v(!l),className:"text-green-600 hover:underline font-medium",children:l?"Login":"Register"})]})]})})};export{Y as default};
